import nlp_debug
from time import sleep
import random
"""
program_data = [
    0x0019, #MOV E, 0x00AA
    0x3005,
    0x00AA,
    
    0x0019, #MOV E, 0x0A
    0x100A,
    
    0x001D, #JMP 0x0000
    0x1000
]
"""
program_data = [
    0x001D,0x3000,0x0300,0x001D,0x10CF,0x001D,0x1070,0x001D,0x3095,0x0195,0x001D,0x30E7,0x01E7,0x001D,0x309F,0x029F,0x001D,0x1016,0x001D,0x1019,0x001D,0x1023,0x0619,0x51FF,0xC01D,0x0015,0x9000,0x061F,0x5300,0x8000,0x09DD,0xD10E,0x0615,0x51FF,0xC01D,0xD015,0x0015,0x102A,0xB01D,0x1031,0xC015,0xC01D,0x0020,0x006F,0x006B,0x002E,0x000D,0x000A,0x0000,0x901E,0x3010,0x8010,0x001E,0x5000,0xC015,0x091F,0x5100,0x0ACD,0xD104,0x0019,0x5000,0x091D,0xD109,0x801E,0x3010,0x8010,0xC01D,0x9016,0x3014,0x8014,0x9017,0x3015,0x8015,0x0016,0x1000,0x0017,0x5000,0x091F,0x6104,0x0ACD,0xD118,0x6217,0x7000,0x6217,0x7000,0x6217,0x7000,0x6217,0x7000,0x0615,0x710F,0x091F,0x1509,0x0AE5,0x5137,0x091F,0x1509,0x0AF5,0x5130,0xB01D,0x1010,0x1B16,0x6000,0x091D,0xD11C,0x8016,0x3014,0x8014,0x8017,0x3015,0x8015,0xC01D,0x9016,0x301A,0x801A,0x9017,0x301B,0x801B,0x9018,0x301C,0x801C,0x0016,0x1000,0x0017,0x1000,0x091F,0x6104,0x0ACD,0xD12F,0xB01D,0x1012,0x091F,0x513A,0x0AFD,0xD10A,0x091F,0x5130,0x0AED,0xD131,0xB01D,0x1010,0x0915,0x5130,0x0A1D,0xD10C,0x091F,0x5141,0x0AED,0xD127,0x091F,0x5147,0x0AFD,0xD123,0xB01D,0x1010,0x0915,0x5137,0x061F,0x53F0,0xFFF0,0x0ADD,0xD11A,0x6017,0x7000,0x6017,0x7000,0x6017,0x7000,0x6017,0x7000,0x1217,0x7500,0x1B16,0x6000,0x091D,0xD133,0x0015,0x7000,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0x8018,0x3018,0x8018,0x001F,0x8000,0x09CD,0xD146,0xC01F,0xD018,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0x9015,0x3020,0x8020,0x9016,0x3021,0x8021,0x9017,0x3022,0x8022,0x9018,0x3023,0x8023,0xC018,0x9018,0x3024,0x8024,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x3089,0x0189,0xB01D,0x1031,0x0015,0x100A,0xB01D,0x1010,0x0015,0x100D,0xB01D,0x1010,0x0015,0x103E,0xB01D,0x1010,0xB01D,0x1005,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1010,0x0015,0x100D,0xB01D,0x1010,0x0015,0x103E,0xB01D,0x1010,0xB01D,0x1005,0x0018,0x5000,0x0015,0x3089,0x0189,0xB01D,0x1031,0x0015,0x7000,0xB01D,0x1043,0x0015,0x102D,0xB01D,0x1010,0x0015,0x8000,0xB01D,0x1043,0x0015,0x100D,0xB01D,0x1010,0x0015,0x100A,0xB01D,0x1010,0x0617,0x73F8,0xFFF8,0x091F,0x8700,0x0AED,0xD140,0x0015,0x7000,0xB01D,0x1043,0x0015,0x1020,0xB01D,0x1010,0xB01D,0x1010,0xBA1D,0xD112,0x0015,0x1020,0xB01D,0x1010,0x0917,0x7108,0xBA1D,0xD119,0x0015,0x100D,0xB01D,0x1010,0x0015,0x100A,0xB01D,0x1010,0x091D,0xD125,0x8015,0x7000,0xB01D,0x1043,0x0015,0x1020,0xB01D,0x1010,0x1B17,0x7000,0x061F,0x7107,0xC0CD,0x091D,0xD10F,0x8015,0x7000,0x091F,0x5120,0x00E5,0x102E,0x091F,0x517F,0x00F5,0x102E,0xB01D,0x1010,0x1B17,0x7000,0x061F,0x7107,0xC0CD,0x091D,0xD113,0xB01D,0x1014,0x8018,0x3024,0x8024,0xD018,0x8015,0x3020,0x8020,0x8016,0x3021,0x8021,0x8017,0x3022,0x8022,0x8018,0x3023,0x8023,0xC01D,0x000D,0x000A,0x004D,0x0045,0x004D,0x0020,0x0044,0x0055,0x004D,0x0050,0x000D,0x000A,0x0000,0x000D,0x000A,0x0041,0x0064,0x0064,0x0072,0x0065,0x0073,0x0073,0x0020,0x003A,0x0000,0x9014,0x302A,0x802A,0x9015,0x302B,0x802B,0x9016,0x302C,0x802C,0x9017,0x302D,0x802D,0x9018,0x302E,0x802E,0x901E,0x3028,0x8028,0x9012,0x3029,0x8029,0x0015,0x30DA,0x01DA,0xB01D,0x1031,0x0017,0x3028,0x8028,0x091F,0x3730,0x8030,0x0AED,0xD114,0x8016,0x7000,0x0015,0x7000,0xB01D,0x1043,0x0015,0x103A,0xB01D,0x1010,0x0015,0x6000,0xB01D,0x1043,0xB01D,0x1014,0x1B17,0x7000,0x091D,0xD119,0xB01D,0x1014,0x8015,0x302B,0x802B,0x8016,0x302C,0x802C,0x8017,0x302D,0x802D,0x8018,0x302F,0x802F,0xC01D,0x000D,0x000A,0x0052,0x0045,0x0047,0x0020,0x0044,0x0055,0x004D,0x0050,0x000D,0x000A,0x0000,0x9015,0x3030,0x8030,0x9016,0x3031,0x8031,0x9017,0x3032,0x8032,0x9018,0x3033,0x8033,0xC018,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x3073,0x0273,0xB01D,0x1031,0x0015,0x103E,0xB01D,0x1010,0xB01D,0x1005,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1010,0x0015,0x100D,0xB01D,0x1010,0x0015,0x302E,0x022E,0x9015,0x3018,0x8018,0xBA1D,0xD127,0xB01D,0x1005,0x9015,0x7000,0x0016,0x5000,0x0015,0x100D,0xB01D,0x1010,0xBA1D,0xD11B,0x8015,0x7000,0x091F,0x5600,0x0ADD,0xD12A,0xB01D,0x1014,0x1B17,0x7000,0x091D,0xD11A,0x091F,0x510D,0x09CD,0xD10A,0x091F,0x511B,0x0ACD,0xD12D,0x0015,0x3085,0x0285,0xB01D,0x1031,0x091D,0xD129,0x0015,0x7000,0xB01D,0x1043,0x0015,0x103A,0xB01D,0x1010,0x8015,0x7000,0xB01D,0x1043,0x0015,0x1009,0xB01D,0x1010,0x0015,0x102A,0xB01D,0x1010,0xC01D,0x0015,0x307E,0x027E,0xB01D,0x1031,0x0015,0x103A,0xB01D,0x1010,0x8015,0x7000,0xB01D,0x1043,0xB01D,0x1014,0x091D,0xD14F,0xB01D,0x1014,0xD018,0x8015,0x3030,0x8030,0x8016,0x3031,0x8031,0x8017,0x3032,0x8032,0x8018,0x3033,0x8033,0xC01D,0x000D,0x000A,0x004D,0x004F,0x0044,0x0049,0x0046,0x0059,0x000D,0x000A,0x0000,0x0046,0x0041,0x0049,0x004C,0x0045,0x0044,0x0000,0x000D,0x000A,0x0045,0x0072,0x0072,0x003A,0x0075,0x006E,0x006B,0x006E,0x006F,0x0077,0x006E,0x0020,0x006F,0x0070,0x0065,0x0072,0x0061,0x0074,0x0069,0x006F,0x006E,0x000D,0x000A,0x0000,0x9015,0x3034,0x8034,0x9016,0x3035,0x8035,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x30D0,0x02D0,0xB01D,0x1031,0xB01D,0x1005,0x0016,0x5000,0x0015,0x100A,0xB01D,0x1010,0x0015,0x100D,0xB01D,0x1010,0x0015,0x6000,0xB01D,0x1043,0xB01D,0x1014,0x0015,0x30C7,0x02C7,0xD015,0x001D,0x6000,0xB01D,0x1014,0x8015,0x3034,0x8034,0x8016,0x3035,0x8035,0xC01D,0x000D,0x000A,0x0047,0x004F,0x003A,0x0000,0x000D,0x004E,0x004C,0x0050,0x002D,0x0031,0x0036,0x0020,0x006D,0x0069,0x006B,0x0075,0x0062,0x0075,0x0067,0x0020,0x0062,0x0075,0x0069,0x006C,0x0064,0x003A,0x0032,0x0030,0x0032,0x0033,0x002F,0x0030,0x0037,0x002F,0x0030,0x0031,0x002D,0x0031,0x0030,0x000D,0x000A,0x0000,0x004D,0x0041,0x0049,0x004E,0x0015,0x30D6,0x02D6,0xB01D,0x1031,0xB01D,0x1014,0xB01D,0x1012,0x091F,0x5144,0xB0CD,0x1003,0x091F,0x5152,0xB0CD,0x1007,0x091F,0x514D,0xB0CD,0x100A,0x091F,0x5147,0xB0CD,0x100D,0xB01D,0x1014,0x091D,0xD116,
]

if __name__ == '__main__':
    debug = nlp_debug.debugger()

    debug.reset()
    id = debug.scan_devides()
    if id != 3:
        del debug
        exit()
    
    CTRL = 0x00
    DATA = 0x01
    ADDRESS = 0x02

    WR = 0b0001
    RD = 0b0010
    CPU_ADDR = 0b0100
    RS = 0b1000

    print("CTRL DIR_SET")
    debug.dir_set(CTRL,0xFFFF)
    print("DATA DIR_SET")
    debug.dir_set(DATA,0x0000)
    debug.execute(DATA,"REVERSE_MODE",0x0001)
    print("ADDRESS CTRL DIR_SET")
    debug.dir_set(ADDRESS,0x0000)
    
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)
    dmy = input("Ready?")
    debug.dir_set(ADDRESS,0xFFFF)
    for now_address in range(len(program_data)):
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)
        
        debug.output(ADDRESS,now_address)
        
        debug.dir_set(DATA,0xFFFF)
        debug.output(DATA,program_data[now_address])
        debug.output(CTRL,WR*1 | RD*0 | CPU_ADDR*1 | RS*0)
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)

        debug.dir_set(DATA,0x0000)
        debug.output(CTRL,WR*0 | RD*1 | CPU_ADDR*1 | RS*0)
        value = debug.input(DATA)
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)
        if value == program_data[now_address]:
            print("OK ",end="")
        else:
            print("Error ",end="")
        print("{:04x}".format(now_address),"\t:\t","{:04x}".format(value),"{:04x}".format(program_data[now_address]))
        #sleep(0.5)
    
    debug.dir_set(DATA,0x0000)
    for now_address in range(len(program_data)):
        debug.output(ADDRESS,now_address)
        debug.output(CTRL,WR*0 | RD*1 | CPU_ADDR*1 | RS*0)
        value = debug.input(DATA)
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)
        print("{:04x}".format(now_address),"\t:\t","{:04x}".format(value))
        #sleep(0.5)
    
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*0)
    debug.dir_set(ADDRESS,0x0000)
    debug.dir_set(DATA,0x0000)
    sleep(0.1)
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*0)
    sleep(0.1)
    dmy = input("Run")
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*1)
    dmy = input("End")
    del debug