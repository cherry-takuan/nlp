import nlp_debug
from time import sleep
import random
from tqdm import tqdm
program_data = [
    0x001D,0x3066,0x0366,0x001D,0x301C,0x011C,0x001D,0x10BB,0x001D,0x30CD,0x01CD,0x001D,0x30CD,0x01CD,0x001D,0x3007,0x0307,0x001D,0x1033,0x001D,0x1053,0x001D,0x1069,0x001D,0x1077,0x001D,0x108D,0x0015,0x3001,0xFF01,0x9011,0x5000,0x9011,0x5000,0x9011,0x5000,0x9011,0x5040,0x000F,0xF000,0x9011,0x504F,0x9011,0x5007,0x901F,0x3050,0x8050,0x901F,0x3051,0x8051,0xC01D,0x9016,0x3052,0x8052,0x9015,0x3053,0x8053,0x8016,0x3054,0x8054,0x091F,0x6100,0xB00D,0x303E,0x033E,0x8015,0x3053,0x8053,0x8016,0x3001,0xFF01,0x061F,0x6101,0x09DD,0xD308,0x0008,0x9015,0x3000,0xFF00,0x8016,0x3052,0x8052,0xC01D,0xD016,0x0016,0x3001,0xFF01,0x9011,0x6027,0x8015,0x6000,0x9011,0x6007,0x061F,0x5102,0x09DD,0xD30B,0x000B,0x8015,0x3000,0xFF00,0x0615,0x51FF,0xC016,0xC01D,0xD015,0x0015,0x1070,0xB01D,0x1017,0xC015,0xC01D,0x0020,0x006F,0x006B,0x002E,0x000D,0x000A,0x0000,0x9016,0x3010,0x8010,0x0016,0x5000,0x8015,0x6000,0x091F,0x5100,0x0ADD,0xD107,0xB01D,0x1011,0x1B16,0x6000,0x091D,0xD30D,0x000D,0x8016,0x3010,0x8010,0xC01D,0x9016,0x3014,0x8014,0x9017,0x3015,0x8015,0x0016,0x1000,0x0017,0x5000,0x091F,0x6104,0x0ADD,0xD119,0x2217,0x7000,0x2217,0x7000,0x2217,0x7000,0x2217,0x7000,0x0615,0x710F,0x091F,0x1509,0x0AF5,0x5137,0x091F,0x1509,0x0AE5,0x5130,0xB01D,0x1011,0x1B16,0x6000,0x091D,0xD31D,0x001D,0x8016,0x3014,0x8014,0x8017,0x3015,0x8015,0xC01D,0x9016,0x301A,0x801A,0x9017,0x301B,0x801B,0x9018,0x301C,0x801C,0x0016,0x1000,0x0017,0x1000,0x091F,0x6104,0x0ADD,0xD130,0xB01D,0x1013,0x091F,0x513A,0x0AED,0xD10A,0x091F,0x5130,0x0AFD,0xD132,0xB01D,0x1011,0x0915,0x5130,0x0A1D,0xD10C,0x091F,0x5141,0x0AFD,0xD128,0x091F,0x5147,0x0AED,0xD124,0xB01D,0x1011,0x0915,0x5137,0x061F,0x53F0,0xFFF0,0x0ACD,0xD11B,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x1217,0x7500,0x1B16,0x6000,0x091D,0xD334,0x0034,0x0015,0x7000,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0x8018,0x3018,0x8018,0x001F,0x8000,0x09DD,0xD348,0x0048,0xC01F,0xD018,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0x9015,0x3020,0x8020,0x9016,0x3021,0x8021,0x9017,0x3022,0x8022,0x9018,0x3023,0x8023,0xC018,0x9018,0x3024,0x8024,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x103E,0xB01D,0x1011,0xB01D,0x1006,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x103E,0xB01D,0x1011,0xB01D,0x1006,0x0018,0x5000,0x0015,0x7000,0xB01D,0x1019,0x0015,0x102D,0xB01D,0x1011,0x0015,0x8000,0xB01D,0x1019,0x0015,0x100D,0xB01D,0x1011,0x0015,0x100A,0xB01D,0x1011,0x0617,0x73FC,0xFFFC,0x091F,0x8700,0x0AFD,0xD141,0x0015,0x7000,0xB01D,0x1019,0x0015,0x102D,0xB01D,0x1011,0xBA1D,0xD113,0x0015,0x1020,0xB01D,0x1011,0x0917,0x7104,0xBA1D,0xD11B,0x0015,0x100D,0xB01D,0x1011,0x0015,0x100A,0xB01D,0x1011,0x091D,0xD324,0x0024,0x8015,0x7000,0xB01D,0x1019,0x0015,0x1020,0xB01D,0x1011,0x1B17,0x7000,0x061F,0x7103,0xC0DD,0x091D,0xD310,0x0010,0x8015,0x7000,0x091F,0x5120,0x00F5,0x102E,0x091F,0x517F,0x00E5,0x102E,0xB01D,0x1011,0x1B17,0x7000,0x061F,0x7103,0xC0DD,0x091D,0xD314,0x0014,0xB01D,0x1015,0x8018,0x3024,0x8024,0xD018,0x8015,0x3020,0x8020,0x8016,0x3021,0x8021,0x8017,0x3022,0x8022,0x8018,0x3023,0x8023,0xC01D,0x000D,0x000A,0x004D,0x0045,0x004D,0x0020,0x0044,0x0055,0x004D,0x0050,0x000D,0x000A,0x0000,0x9015,0x3030,0x8030,0x9016,0x3031,0x8031,0x9017,0x3032,0x8032,0x9018,0x3033,0x8033,0xC018,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x305D,0x025D,0xB01D,0x1017,0x0015,0x103E,0xB01D,0x1011,0xB01D,0x1006,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x3015,0x0215,0x9015,0x3018,0x8018,0xBA1D,0xD12A,0xB01D,0x1006,0x9015,0x7000,0x0016,0x5000,0x0015,0x100D,0xB01D,0x1011,0xBA1D,0xD11E,0x8015,0x7000,0x091F,0x5600,0x0ACD,0xD12D,0xB01D,0x1015,0x1B17,0x7000,0x091D,0xD31B,0x001B,0x091F,0x510D,0x09DD,0xD30C,0x000C,0x091F,0x511B,0x0ADD,0xD12F,0x0015,0x306F,0x026F,0xB01D,0x1017,0x091D,0xD32C,0x002C,0x0015,0x7000,0xB01D,0x1019,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0x0015,0x1009,0xB01D,0x1011,0x0015,0x102A,0xB01D,0x1011,0xC01D,0x0015,0x3068,0x0268,0xB01D,0x1017,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0xB01D,0x1015,0x091D,0xD353,0x0053,0xB01D,0x1015,0xD018,0x8015,0x3030,0x8030,0x8016,0x3031,0x8031,0x8017,0x3032,0x8032,0x8018,0x3033,0x8033,0xC01D,0x000D,0x000A,0x004D,0x004F,0x0044,0x0049,0x0046,0x0059,0x000D,0x000A,0x0000,0x0046,0x0041,0x0049,0x004C,0x0045,0x0044,0x0000,0x000D,0x000A,0x0045,0x0072,0x0072,0x003A,0x0075,0x006E,0x006B,0x006E,0x006F,0x0077,0x006E,0x0020,0x006F,0x0070,0x0065,0x0072,0x0061,0x0074,0x0069,0x006F,0x006E,0x000D,0x000A,0x0000,0x9015,0x3030,0x8030,0x9016,0x3031,0x8031,0x9017,0x3032,0x8032,0x9018,0x3033,0x8033,0x9011,0x3054,0x8054,0xC018,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x30FE,0x02FE,0xB01D,0x1017,0x0015,0x103E,0xB01D,0x1011,0xB01D,0x1006,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x30C8,0x02C8,0x9015,0x3018,0x8018,0xB01D,0x1006,0x9015,0x7000,0x8016,0x7000,0x091F,0x5600,0x0ACD,0xD116,0x1B17,0x7000,0x091D,0xD30F,0x000F,0x091F,0x510D,0x09DD,0xD30A,0x000A,0x091F,0x511B,0x0ADD,0xD11A,0x0015,0x306F,0x026F,0xB01D,0x1017,0x091D,0xD320,0x0020,0x0015,0x3068,0x0268,0xB01D,0x1017,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0xB01D,0x1015,0x091D,0xD332,0x0032,0xB01D,0x1015,0xD018,0x901F,0x3054,0x8054,0x8015,0x3030,0x8030,0x8016,0x3031,0x8031,0x8017,0x3032,0x8032,0x8018,0x3033,0x8033,0xC01D,0x000D,0x000A,0x004C,0x004F,0x0041,0x0044,0x000D,0x000A,0x0000,0x9015,0x3034,0x8034,0x9016,0x3035,0x8035,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x3038,0x0338,0xB01D,0x1017,0xB01D,0x1006,0x0016,0x5000,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x6000,0xB01D,0x1019,0xB01D,0x1015,0x0015,0x302F,0x032F,0xD015,0x001D,0x6000,0xB01D,0x1015,0x8015,0x3034,0x8034,0x8016,0x3035,0x8035,0xC01D,0x000D,0x000A,0x0047,0x004F,0x003A,0x0000,0x000D,0x004E,0x004C,0x0050,0x002D,0x0031,0x0036,0x0041,0x0020,0x006D,0x0069,0x006B,0x0075,0x0062,0x0075,0x0067,0x0020,0x0062,0x0075,0x0069,0x006C,0x0064,0x003A,0x0032,0x0030,0x0032,0x0034,0x002F,0x0030,0x0036,0x002F,0x0031,0x0037,0x000D,0x000A,0x0000,0x004D,0x0041,0x0049,0x004E,0x001E,0x30FF,0xEFFF,0x9011,0x3054,0x8054,0xB01D,0x101B,0x0015,0x303E,0x033E,0xB01D,0x1017,0xB01D,0x1015,0xB01D,0x1013,0x091F,0x5144,0xB0DD,0x1003,0x091F,0x5152,0xB0DD,0x1008,0x091F,0x514D,0xB0DD,0x100B,0x091F,0x5147,0xB0DD,0x100E,0x091F,0x514C,0xB0DD,0x3089,0x0289,0xB01D,0x1015,0x091D,0xD31C,0x001C,
]
#"""
if __name__ == '__main__':
    debug = nlp_debug.debugger()

    debug.reset()
    id = debug.scan_devides()
    if id != 3:
        del debug
        exit()
    
    DATA = 0x00
    ADDRESS = 0x01
    CTRL = 0x02

    WR = 0b0010
    RD = 0b0001
    CPU_ADDR = 0b0100
    RS = 0b1000

    print("CTRL DIR_SET")
    debug.dir_set(CTRL,0xFFFF)
    print("DATA DIR_SET")
    debug.dir_set(DATA,0x0000)
    debug.execute(DATA,"REVERSE_MODE",0x0001)
    print("ADDRESS CTRL DIR_SET")
    debug.dir_set(ADDRESS,0x0000)
    debug.execute(ADDRESS,"REVERSE_MODE",0x0001)
    
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*1)
    dmy = input("Ready?")
    debug.dir_set(ADDRESS,0xFFFF)
    for now_address in tqdm(range(len(program_data))):
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*1)
        
        debug.output(ADDRESS,now_address)
        
        debug.dir_set(DATA,0xFFFF)
        debug.output(DATA,program_data[now_address])
        debug.output(CTRL,WR*1 | RD*0 | CPU_ADDR*1 | RS*1)
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*1)

        debug.dir_set(DATA,0x0000)
        debug.output(CTRL,WR*0 | RD*1 | CPU_ADDR*1 | RS*1)
        value = debug.input(DATA)
        debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*1)
        if value == program_data[now_address]:
            pass
        else:
            print("Error ",end="")
            print("{:04x}".format(now_address),"\t:\t","{:04x}".format(value),"{:04x}".format(program_data[now_address]))
            dmy = input("Run")
        #sleep(0.005)
    debug.dir_set(DATA,0x0000)

    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*1 | RS*1)
    debug.dir_set(ADDRESS,0x0000)
    debug.dir_set(DATA,0x0000)
    sleep(0.1)
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*1)
    sleep(0.1)
    dmy = input("Start : Enter")
    debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*0)
    while True:
        dmy = input("Running...(reboot : r/stop : q)")
        if dmy == "r":
            sleep(0.5)
            debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*1)
            sleep(0.5)
            debug.output(CTRL,WR*0 | RD*0 | CPU_ADDR*0 | RS*0)
        if dmy == "q":
            break
    del debug