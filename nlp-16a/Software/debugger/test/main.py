import nlp_debug
from time import sleep
import random
from tqdm import tqdm
program_data = [
    0x001D,0x3094,0x0394,0x001D,0x3026,0x0126,0x001D,0x10B0,0x001D,0x30AF,0x01AF,0x001D,0x30AF,0x01AF,0x001D,0x30D5,0x02D5,0x001D,0x102A,0x001D,0x104A,0x001D,0x105E,0x001D,0x106C,0x001D,0x1082,0x001D,0x300C,0x010C,0x0015,0x3001,0xFF01,0x9011,0x5000,0x901F,0x3050,0x8050,0x901F,0x3051,0x8051,0xC01D,0x9016,0x3052,0x8052,0x9015,0x3053,0x8053,0x8016,0x3054,0x8054,0x091F,0x6100,0xB00D,0x30FC,0x02FC,0x8015,0x3053,0x8053,0x8016,0x3001,0xFF01,0x061F,0x6102,0x09DD,0xD308,0x0008,0x9015,0x3000,0xFF00,0x8016,0x3052,0x8052,0xC01D,0xD016,0x0016,0x3001,0xFF01,0x8015,0x6000,0x0615,0x5109,0x091F,0x5109,0x09CD,0xD309,0x0009,0x8015,0x3000,0xFF00,0x0615,0x51FF,0xC016,0xC01D,0xD015,0x0015,0x1065,0xB01D,0x1017,0xC015,0xC01D,0x0020,0x006F,0x006B,0x002E,0x000D,0x000A,0x0000,0x9016,0x3010,0x8010,0x0016,0x5000,0x8015,0x6000,0x091F,0x5100,0x0ADD,0xD107,0xB01D,0x1011,0x1B16,0x6000,0x091D,0xD30D,0x000D,0x8016,0x3010,0x8010,0xC01D,0x9016,0x3014,0x8014,0x9017,0x3015,0x8015,0x0016,0x1000,0x0017,0x5000,0x091F,0x6104,0x0ADD,0xD119,0x2217,0x7000,0x2217,0x7000,0x2217,0x7000,0x2217,0x7000,0x0615,0x710F,0x091F,0x1509,0x0AF5,0x5137,0x091F,0x1509,0x0AE5,0x5130,0xB01D,0x1011,0x1B16,0x6000,0x091D,0xD31D,0x001D,0x8016,0x3014,0x8014,0x8017,0x3015,0x8015,0xC01D,0x9016,0x301A,0x801A,0x9017,0x301B,0x801B,0x9018,0x301C,0x801C,0x0017,0x1000,0x0015,0x7000,0xB01D,0x1019,0xB01D,0x1013,0xD015,0x091F,0x510D,0x0ADD,0xD11F,0xB91D,0xD3AE,0x00AE,0x091F,0x53FF,0xFFFF,0x0ADD,0xD124,0xC01F,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x1217,0x7500,0x0015,0x3007,0x0107,0xB01D,0x1017,0x0015,0x7000,0xB01D,0x1019,0x091D,0xD326,0x0026,0xC01F,0x0015,0x7000,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0xC015,0x8018,0x3018,0x8018,0x001F,0x8000,0x09DD,0xD33C,0x003C,0xC01F,0xD018,0x8016,0x301A,0x801A,0x8017,0x301B,0x801B,0x8018,0x301C,0x801C,0xC01D,0x0008,0x0008,0x0008,0x0008,0x0000,0x091F,0x513A,0x0AED,0xD107,0x091F,0x5130,0x0AFD,0xD10E,0x0915,0x5130,0xC01D,0x091F,0x5141,0x0AFD,0xD107,0x091F,0x5147,0x0AED,0xD103,0x0915,0x5137,0xC01D,0x0015,0x30FF,0xFFFF,0xC01D,0x9015,0x3020,0x8020,0x9016,0x3021,0x8021,0x9017,0x3022,0x8022,0x9018,0x3023,0x8023,0x9018,0x3024,0x8024,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x30AB,0x01AB,0xB01D,0x1017,0xB01D,0x1006,0x0017,0x5000,0x0015,0x102D,0xB01D,0x1011,0xB01D,0x1006,0x0018,0x5000,0x0015,0x100D,0xB01D,0x1011,0x0015,0x100A,0xB01D,0x1011,0x0617,0x73FC,0xFFFC,0x091F,0x8700,0x0AFD,0xD141,0x0015,0x7000,0xB01D,0x1019,0x0015,0x102D,0xB01D,0x1011,0xBA1D,0xD113,0x0015,0x1020,0xB01D,0x1011,0x0917,0x7104,0xBA1D,0xD11B,0x0015,0x100D,0xB01D,0x1011,0x0015,0x100A,0xB01D,0x1011,0x091D,0xD324,0x0024,0x8015,0x7000,0xB01D,0x1019,0x0015,0x1020,0xB01D,0x1011,0x1B17,0x7000,0x061F,0x7103,0xC0DD,0x091D,0xD310,0x0010,0x8015,0x7000,0x091F,0x5120,0x00F5,0x102E,0x091F,0x517F,0x00E5,0x102E,0xB01D,0x1011,0x1B17,0x7000,0x061F,0x7103,0xC0DD,0x091D,0xD314,0x0014,0x8018,0x3024,0x8024,0x8015,0x3020,0x8020,0x8016,0x3021,0x8021,0x8017,0x3022,0x8022,0x8018,0x3023,0x8023,0xC01D,0x0044,0x0020,0x003E,0x0000,0x9015,0x3030,0x8030,0x9016,0x3031,0x8031,0x9017,0x3032,0x8032,0x9018,0x3033,0x8033,0xC018,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x3039,0x0239,0xB01D,0x1017,0xB01D,0x1006,0x0017,0x5000,0x0015,0x100A,0xB01D,0x1011,0x0015,0x100D,0xB01D,0x1011,0x0015,0x30F3,0x01F3,0x9015,0x3018,0x8018,0xBA1D,0xD12A,0xB01D,0x1006,0x9015,0x7000,0x0016,0x5000,0x0015,0x100D,0xB01D,0x1011,0xBA1D,0xD11E,0x8015,0x7000,0x091F,0x5600,0x0ACD,0xD12D,0xB01D,0x1015,0x1B17,0x7000,0x091D,0xD31B,0x001B,0x091F,0x5120,0x09DD,0xD30C,0x000C,0x091F,0x511B,0x0ADD,0xD12F,0x0015,0x3044,0x0244,0xB01D,0x1017,0x091D,0xD32C,0x002C,0x0015,0x7000,0xB01D,0x1019,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0x0015,0x1009,0xB01D,0x1011,0x0015,0x102A,0xB01D,0x1011,0xC01D,0x0015,0x303D,0x023D,0xB01D,0x1017,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0xB01D,0x1015,0x091D,0xD353,0x0053,0xD018,0x8015,0x3030,0x8030,0x8016,0x3031,0x8031,0x8017,0x3032,0x8032,0x8018,0x3033,0x8033,0xC01D,0x004D,0x0020,0x003E,0x0000,0x0046,0x0041,0x0049,0x004C,0x0045,0x0044,0x0000,0x000D,0x000A,0x0045,0x0072,0x0072,0x003A,0x0075,0x006E,0x006B,0x006E,0x006F,0x0077,0x006E,0x0020,0x006F,0x0070,0x0065,0x0072,0x0061,0x0074,0x0069,0x006F,0x006E,0x000D,0x000A,0x0000,0x0015,0x309C,0x029C,0xB01D,0x1017,0xB01D,0x1006,0xB01D,0x1015,0x0017,0x1001,0x9017,0x3054,0x8054,0x0017,0x5000,0xBA1D,0xD130,0x9015,0x7000,0x8016,0x7000,0x091F,0x5600,0x0ACD,0xD10B,0x1B17,0x7000,0x0015,0x102E,0x061F,0x7107,0xB0DD,0x1011,0x091D,0xD315,0x0015,0x0015,0x303D,0x023D,0xB01D,0x1017,0x0015,0x103A,0xB01D,0x1011,0x8015,0x7000,0xB01D,0x1019,0x091D,0xD325,0x0025,0x901F,0x3054,0x8054,0xC01F,0xC01F,0xC01F,0xB01D,0x1015,0xC01D,0x004C,0x0020,0x003E,0x0000,0xD016,0xD017,0x0016,0x1000,0x091F,0x6104,0x0ADD,0xD128,0xB01D,0x1013,0x091F,0x511B,0x09DD,0xD31C,0x001C,0x091F,0x512F,0x09DD,0xD321,0x0021,0x091F,0x510D,0x09DD,0xD326,0x0026,0xB01D,0x101B,0x091F,0x53FF,0xFFFF,0x09DD,0xD33E,0x003E,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x2017,0x7000,0x1217,0x7500,0x1B16,0x6000,0x091D,0xD32C,0x002C,0x0015,0x7000,0xC017,0xC016,0xC01D,0x9015,0x3034,0x8034,0x9016,0x3035,0x8035,0x0015,0x1000,0x9015,0x3018,0x8018,0x0015,0x30F8,0x02F8,0xB01D,0x1017,0xB01D,0x1006,0x0016,0x5000,0xB01D,0x1015,0x0015,0x30F1,0x02F1,0xD015,0x001D,0x6000,0x8015,0x3034,0x8034,0x8016,0x3035,0x8035,0xC01D,0x0047,0x0020,0x003E,0x0000,0xD015,0xD017,0x8016,0x3050,0x8050,0x091F,0x6128,0xBAED,0xD12F,0x091F,0x510D,0x0ADD,0xD11D,0x091F,0x510A,0x0ADD,0xD111,0x091F,0x5108,0x0ADD,0xD11B,0x0A17,0x6340,0xF740,0x9015,0x7000,0x1B16,0x6000,0x9016,0x3050,0x8050,0xC017,0xC015,0xC01D,0xBA1D,0xD114,0x901F,0x3050,0x8050,0xC017,0xC015,0xC01D,0x901F,0x3050,0x8050,0xC017,0xC015,0xC01D,0x1816,0x6000,0x9016,0x3050,0x8050,0xC017,0xC015,0xC01D,0xD015,0x0016,0x3040,0xF040,0x8015,0x6000,0x9915,0x6140,0x091F,0x6368,0xF768,0x0AED,0xD105,0x1B16,0x6000,0x09FD,0xD30E,0x000E,0x0015,0x3040,0xF740,0x901F,0x5000,0x1B15,0x5000,0x091F,0x5368,0xF768,0x09FD,0xD30A,0x000A,0x0016,0x1000,0xC015,0xC01D,0x000D,0x004E,0x004C,0x0050,0x002D,0x0031,0x0036,0x0041,0x0020,0x006D,0x0069,0x006B,0x0075,0x0062,0x0075,0x0067,0x0020,0x0076,0x0032,0x002E,0x0030,0x0020,0x0062,0x0075,0x0069,0x006C,0x0064,0x003A,0x0032,0x0030,0x0032,0x0034,0x002F,0x0030,0x0039,0x002F,0x0031,0x0036,0x000D,0x000A,0x0028,0x0063,0x0029,0x0063,0x0068,0x0065,0x0072,0x0072,0x0079,0x0020,0x0074,0x0065,0x0063,0x0068,0x000D,0x000A,0x0000,0x004D,0x0041,0x0049,0x004E,0x001E,0x30FF,0xEFFF,0x9011,0x3054,0x8054,0xB01D,0x101E,0x0015,0x3057,0x0357,0xB01D,0x1017,0xB01D,0x1015,0x0015,0x30C0,0x03C0,0xB01D,0x1017,0xB01D,0x1013,0x091F,0x5144,0xB0DD,0x1003,0x091F,0x514D,0xB0DD,0x100B,0x091F,0x5147,0xB0DD,0x100E,0x091F,0x514C,0xB0DD,0x305E,0x025E,0xB01D,0x1015,0x091D,0xD31D,0x001D,0x000D,0x000A,0x002A,0x0000,
]
#"""
if __name__ == '__main__':
    debug = nlp_debug.debugger()

    debug.reset()
    id = debug.scan_devides()
    if id != 3:
        del debug
        exit()
    
    CTRL = 0x02
    DATA = 0x01
    ADDRESS = 0x00

    WR = 0b0001
    RD = 0b0010
    RS = 0b0100

    debug.dir_set(CTRL,0xFFFF)
    #debug.execute(CTRL,"REVERSE_MODE",0x0001)
    debug.dir_set(DATA,0x0000)
    debug.execute(DATA,"REVERSE_MODE",0x0001)
    debug.dir_set(ADDRESS,0x0000)
    debug.execute(ADDRESS,"REVERSE_MODE",0x0001)
    
    debug.output(CTRL,WR*1 | RD*1 | RS*1)
    dmy = input("Ready?")
    debug.dir_set(ADDRESS,0xFFFF)
    for now_address in tqdm(range(len(program_data))):
        debug.output(CTRL,WR*1 | RD*1 | RS*1)
        
        debug.output(ADDRESS,now_address)
        
        debug.dir_set(DATA,0xFFFF)
        debug.output(DATA,program_data[now_address])
        debug.output(CTRL,WR*0 | RD*1 | RS*1)
        debug.output(CTRL,WR*1 | RD*1 | RS*1)

        debug.dir_set(DATA,0x0000)
        debug.output(CTRL,WR*1 | RD*0 | RS*1)
        value = debug.input(DATA)
        debug.output(CTRL,WR*1 | RD*1 | RS*1)
        if value == program_data[now_address]:
            pass
        else:
            print("Error ",end="")
            print("{:04x}".format(now_address),"\t:\t","{:04x}".format(value),"{:04x}".format(program_data[now_address]))
            dmy = input("Run")
        #sleep(0.005)
    debug.dir_set(DATA,0x0000)

    debug.output(CTRL,WR*1 | RD*1 | RS*1)
    debug.dir_set(ADDRESS,0x0000)
    debug.dir_set(DATA,0x0000)
    sleep(0.1)
    dmy = input("Start : Enter")
    debug.output(CTRL,WR*1 | RD*1 | RS*0)
    while True:
        dmy = input("Running...(reboot : r/stop : q)")
        if dmy == "r":
            sleep(0.5)
            debug.output(CTRL,WR*1 | RD*1 | RS*1)
            sleep(0.5)
            debug.output(CTRL,WR*1 | RD*1 | RS*0)
        if dmy == "q":
            break
    del debug