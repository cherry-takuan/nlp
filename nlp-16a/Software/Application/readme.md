# アプリケーション例
NLP-16で実際に動作したアプリケーション例です．
このディレクトリにあるnlpasm.pyや[NLP-16Aオンラインアセンブラ](https://cherry-takuan.org/nlpasm/)からアセンブル可能。

- mikubug.asm  
モニタプログラムです．MIKBUGをパクってミクバグにしました．意味はない．  
以下のプログラムはこのモニタプログラムから呼び出して実行する．
  
- life_game.asm
知人の [きっちーさん](https://twitter.com/rikeden_net)が書いてくださったライフゲームのプログラムの修正版．  
なぜ修正版かと言うと，NLP-16には公式アセンブラが2種類あり，後発のアセンブラであるちぇりー製アセンブラで動くようにしたかったからという...なお，ちぇりー製アセンブラは記法が悪い意味でめちゃくちゃで癖が強い．  
0x9000-900Fの間を盤面の記憶に使用する(つまりその間に干渉する位置にはプログラムを配置できない)

- RPN.asm
逆ポーランド記法の計算機．多分動く

- gochiusa.asm
CPU本体から放射されるノイズを使用した演奏プログラム。実行すると付近においてあるラジオからごちうさOPが鳴るはず。(1.4MHz前後で使用し，ラジオのチューニングもその付近)

- pi.asm
円周率を150桁計算できる。3MHzで10分ほどかかる。がたろう氏のプログラムを移植した。  
参考:[自作TTLコンピュータで円周率を計算する](http://diode.matrix.jp/SOFT/R8/PAI_1.htm) がたろう  
0x9000-9200の間を数値保持に使用
- MSMP.asm
自作CPUを語る会の有志で策定，実装を行った通信プロトコル。  
[自作CPU向けメッセージングプロトコル](https://scrapbox.io/uchan/%E8%87%AA%E4%BD%9CCPU%E5%90%91%E3%81%91%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%83%B3%E3%82%B0%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB)  
2024年冬に行った自作CPUを語る会で実機実験を行った。  
[自作 CPU 同士で通信してみた](https://uchan.net/ublog.cgi/communicating-between-toy-cpus) uchan  
本アプリケーションはMSMPで通信するだけでなく，逆ポーランド記法の計算式メッセージを受信すると，その計算結果を返信するAPIを含む。

## アプリケーションのロードと実行方法

### プログラムのロード
mikubug起動後，Lコマンドを使用。mikubugは標準のコントロールソフト(Software/debugger/test/main.py)から起動した後，自動的に立ち上がりプロンプト*が表示される。Lを入力後開始アドレスを入力する。開始アドレスはmikubug本体の領域，mikubugが使用する予約領域，プログラムが使用する領域を避ける必要がある。  
- mikubug 0x0000 - 0x0400
- mikugug予約領域 0x8000 - 0x8100


は指定不可。(MEM領域破壊が起きる)

だいたいいつも0x8100から0x8500あたりを指定している。

ok.が表示されたのちプログラム受信待ちになるため，アセンブラが出力したファイルを送信する。  
送信が完了するとok.が表示されてモニタに戻る。

### プログラムの起動
Gコマンドを使用。Gを入力後，開始アドレスを入力する。アドレスはロード時に使用したアドレスを指定する。


## 付属資料:MIKUBUG使用方法

Mikubugは6800用のモニタプログラム「MIKBUG」を参考に開発した，NLP-16A向けのプログラムのデバッグ，評価を簡単に行うためのソフトウェアです。

コマンド
- Dコマンド ： DUMPコマンド
指定した領域のメモリダンプを行います。バグを放置しているため，先頭アドレスから７FFF以内の領域を超えて指定すると即リターンされます。
- Mコマンド ： MODIFYコマンド
指定したアドレスの内容を操作できます。内容を入力後エンターで内容を操作，スペースで無変更，ESCで終了ができます。これを使用して機械語プログラミングも可能です。
- Lコマンド ： LOADコマンド
指定したアドレスにRS-232C経由でバイナリを転送することができます。ファイルは16進文字列をASCIIで転送し，スラッシュが来ると転送を終了します。自作UARTボードの性能をフルで使用するために色々やってます。
- Rコマンド ： Regコマンド？
レジスタの値を出力するコマンドです。一番デバッグに使用しそうなコマンドですが，全然使わなかったのでv2.0では消去されています。このコマンドが無いせいで実質デバッグ，評価を行うソフトウェアではなくなっている気がします。
- Gコマンド ： GOコマンド
指定したアドレスから始まるユーザープログラムを呼び出すコマンドです。

また，ユーティリティとして，RS-232C入出力ルーチン，PRINTルーチン，数値表示ルーチン，16進数値入力ルーチン，VGA(画面制御)ドライバ等が提供されています。
